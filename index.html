<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Angiopharm - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–æ—Å–º–µ—Ç–∏–∫–∞</title>
  <style>
    /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 0.5s ease-out;
    }
    .loading-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #595377;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    .loading-text {
      color: #595377;
      font-size: 16px;
      font-weight: 500;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* –°–∫—Ä—ã—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ */
    body.loading .wrap { opacity: 0; }
    body.loading .drawer { opacity: 0; }
    body.loading .modal-backdrop { opacity: 0; }
    
    /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    * { transition: all 0.2s ease; }
    
    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ç–µ–Ω–∏ */
    .card:hover { box-shadow: 0 8px 25px rgba(89,83,119,0.15); }
    .drawer { box-shadow: -4px 0 20px rgba(0,0,0,0.1); }
    .modal { box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
    
    :root{
      --primary:#595377; --secondary:#A8A8A8; --bg:#fafbfc; --panel:#ffffff; 
      --text:#2d3748; --muted:#718096; --line:#e2e8f0; --accent:#595377;
      --danger:#e53e3e; --ok:#38a169; --radius:8px; 
      --shadow:0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-lg:0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.06);
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    body{margin:0; font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif; color:var(--text); background:var(--bg)}
    
    /* –ú–æ–±–∏–ª—å–Ω–∞—è —à–∞–ø–∫–∞ */
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:blur(20px);
      background:rgba(255,255,255,0.95); border-bottom:1px solid var(--line);
    }
    .wrap{max-width:100%; margin:0; padding:12px 16px;}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap;}
    .brand{display:flex; align-items:center; gap:8px; font-weight:600; font-size:18px; color:var(--text)}
    .brand img{height:28px; width:auto;}
    .spacer{flex:1}
    
    /* –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
    .cart-btn{display:inline-flex; align-items:center; gap:6px; padding:10px 14px; border-radius:var(--radius); 
              border:none; background:var(--primary); color:#fff; cursor:pointer; 
              font-weight:500; font-size:14px; transition:all 0.2s ease;}
    .cart-btn:hover{background:#4a4563; transform:translateY(-1px);}
    
    .login-btn{display:inline-flex; align-items:center; gap:6px; padding:10px 14px; border-radius:var(--radius); 
               border:1px solid var(--line); background:#fff; color:var(--text); cursor:pointer; 
               font-weight:500; font-size:14px; transition:all 0.2s ease;}
    .login-btn:hover{background:var(--bg); border-color:var(--secondary);}
    
    .badge{display:none; align-items:center; gap:6px; padding:6px 10px; border-radius:var(--radius); 
           background:var(--primary); color:#fff; font-size:12px; font-weight:500;}
    .logout-btn{display:none; padding:10px 14px; border-radius:var(--radius); border:1px solid var(--line); 
                background:#fff; color:var(--text); cursor:pointer; font-weight:500; font-size:14px; transition:all 0.2s ease;}
    .logout-btn:hover{background:var(--bg);}

    /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã */
    .filterbar{display:flex; flex-direction:column; gap:16px; padding:20px 0;}
    .search{position:relative;}
    .search input{
      width:100%; padding:14px 16px 14px 45px; border:1px solid var(--line); 
      border-radius:var(--radius); background:#fff; box-shadow:var(--shadow); 
      outline:none; font-size:16px; transition:all 0.2s ease;
    }
    .search input:focus{border-color:var(--primary); box-shadow:0 0 0 3px rgba(89,83,119,0.1);}
    .search .icon{position:absolute; left:12px; top:50%; transform:translateY(-50%); 
                  color:var(--secondary); font-size:18px;}
    .search .clear{position:absolute; right:12px; top:50%; transform:translateY(-50%); 
                   background:#fff; border:none; border-radius:50%; 
                   padding:4px; cursor:pointer; font-size:16px; color:var(--secondary);
                   transition:all 0.2s ease; width:24px; height:24px; display:flex; align-items:center; justify-content:center;}
    .search .clear:hover{background:var(--bg); color:var(--text);}
    
    .category-chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:16px;}
    .chip{border:1px solid var(--line); background:#fff; border-radius:20px; 
          padding:8px 12px; cursor:pointer; user-select:none; font-weight:500; font-size:13px;
          transition:all 0.2s ease; text-align:center; display:flex; align-items:center; gap:6px; min-height:36px;}
    .chip:hover{border-color:var(--primary); color:var(--primary); background:var(--bg); transform:translateY(-1px);}
    .chip.active{background:var(--primary); color:#fff; border-color:var(--primary);}
    .chip .count{opacity:0.7; font-size:11px; font-weight:600; background:rgba(255,255,255,0.2); 
                 padding:2px 6px; border-radius:10px;}
    .chip.active .count{background:rgba(255,255,255,0.3);}

    /* –ú–æ–±–∏–ª—å–Ω–∞—è —Å–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
    .grid{display:grid; grid-template-columns:1fr; gap:12px; padding:20px 0;}
    @media (min-width: 768px) {
      .grid{grid-template-columns:repeat(3, 1fr); gap:16px;}
    }
    @media (min-width: 1024px) {
      .grid{grid-template-columns:repeat(4, 1fr); gap:20px;}
    }
    
    .card{background:#fff; border:none; border-radius:var(--radius); 
          box-shadow:var(--shadow); display:flex; flex-direction:column; 
          transition:all 0.2s ease; overflow:hidden; position:relative;
          padding:16px; text-align:center;}
    .card:hover{transform:translateY(-2px); box-shadow:var(--shadow-lg);}
    
    .card img{width:100%; height:200px; object-fit:contain; background:#fff; margin-bottom:12px;}
    .card .body{padding:0;}
    .title{font-weight:600; margin:0 0 8px; font-size:14px; color:var(--text); 
           line-height:1.3; text-align:center;}
    .desc{display:none;} /* –°–∫—Ä—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ */
    .price{margin:0; font-weight:600; font-size:16px; color:var(--primary); text-align:center;}
    .price .tag{display:inline-block; font-size:11px; font-weight:500; color:var(--primary); 
                background:#f7fafc; border:1px solid var(--line); padding:2px 8px; 
                border-radius:4px; margin-left:8px; vertical-align:middle;}
    
    .actions{display:flex; align-items:center; margin-top:12px;}
    
    button.primary{background:#595377; color:#fff; border:none; padding:8px 16px; 
                   border-radius:var(--radius); cursor:pointer; font-weight:500; font-size:13px;
                   transition:all 0.2s ease; width:100%; min-height:36px;}
    button.primary:hover{background:#4a4563; transform:translateY(-1px);}
    
    button.secondary{background:#fff; color:var(--text); border:1px solid var(--line); 
                     padding:8px 16px; border-radius:var(--radius); cursor:pointer; 
                     font-weight:500; font-size:13px; transition:all 0.2s ease; min-height:36px;}
    button.secondary:hover{background:var(--bg); border-color:var(--secondary);}
    
    .cart-btn, .login-btn, .logout-btn{padding:8px 16px; font-size:13px; min-height:36px;}

    /* –ú–æ–±–∏–ª—å–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ - —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π */
    .drawer{position:fixed; right:0; top:0; bottom:0; width:100%; max-width:400px; 
            background:#fff; border-left:1px solid var(--line); transform:translateX(100%); 
            transition:all 0.3s ease; box-shadow:-4px 0 20px rgba(0,0,0,0.1); z-index:20; 
            display:flex; flex-direction:column;}
    .drawer.open{transform:translateX(0);}
    .drawer header{position:sticky; top:0; padding:16px; display:flex; align-items:center; gap:12px; 
                    background:#fff; border-bottom:1px solid var(--line); z-index:1; flex-shrink:0;}
    .drawer header strong{font-size:18px; color:var(--text); font-weight:600;}
    
    .cart-list{flex:1; padding:0; overflow-y:auto; overflow-x:hidden; -webkit-overflow-scrolling:touch;}
    
    /* –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–æ–ª–ª–∞ body –∫–æ–≥–¥–∞ –∫–æ—Ä–∑–∏–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞ */
    body.cart-open{overflow:hidden; position:fixed; width:100%; height:100%;}
    
    /* –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã */
    @media (max-width: 768px) {
      .drawer{
        height:100vh; 
        height:100dvh; /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –≤—ã—Å–æ—Ç—É viewport */
        max-height:100vh;
        max-height:100dvh;
      }
      .cart-footer{
        position:relative; 
        z-index:10;
        flex-shrink:0;
      }
      .checkout input, .checkout textarea{
        font-size:16px; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑—É–º –Ω–∞ iOS */
        transform:translateZ(0); /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ */
        -webkit-appearance:none; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        border-radius:8px;
      }
      .checkout input:focus, .checkout textarea:focus{
        transform:translateZ(0) scale(1);
        outline:none;
        box-shadow:0 0 0 2px rgba(89,83,119,0.2);
      }
    }
    .cart-item{display:flex; gap:12px; padding:12px; border-bottom:1px solid #f0f0f0; 
               transition:background-color 0.2s ease;}
    .cart-item:hover{background:#fafbfc;}
    .cart-item img{width:60px; height:60px; object-fit:contain; background:#fff; 
                   border-radius:8px; border:1px solid #f0f0f0; flex-shrink:0;}
    .cart-item .details{flex:1; display:flex; flex-direction:column; gap:6px;}
    .cart-item .name{font-weight:600; font-size:14px; color:var(--text); line-height:1.3;}
    .cart-item .price{color:var(--primary); font-weight:600; font-size:14px;}
    .qty-controls{display:flex; align-items:center; gap:6px; margin-top:6px;}
    .qty-btn{width:28px; height:28px; border:1px solid #e0e0e0; background:#fff; 
             border-radius:6px; cursor:pointer; font-size:14px; font-weight:600; 
             display:flex; align-items:center; justify-content:center; 
             transition:all 0.2s ease; color:#666;}
    .qty-btn:hover{background:#f5f5f5; border-color:var(--primary); color:var(--primary);}
    .qty-btn:active{transform:scale(0.95);}
    .qty-input{width:40px; text-align:center; border:1px solid #e0e0e0; 
               border-radius:6px; padding:4px; font-size:12px; font-weight:600;
               background:#fff; transition:border-color 0.2s ease;}
    .qty-input:focus{border-color:var(--primary); outline:none; box-shadow:0 0 0 2px rgba(89,83,119,0.1);}
    .remove-btn{width:28px; height:28px; border:1px solid #ff6b6b; background:#fff; 
                border-radius:6px; cursor:pointer; font-size:14px; font-weight:600; 
                display:flex; align-items:center; justify-content:center; 
                transition:all 0.2s ease; color:#ff6b6b;}
    .remove-btn:hover{background:#ff6b6b; color:#fff;}
    .remove-btn:active{transform:scale(0.95);}
    
    .cart-footer{padding:16px; border-top:1px solid var(--line); background:#fafbfc;}
    .total{display:flex; justify-content:space-between; font-weight:600; margin:12px 0 16px; 
           font-size:18px; color:var(--text); padding:12px; background:#fff; border-radius:8px; 
           border:1px solid #f0f0f0;}
    .checkout{display:flex; flex-direction:column; gap:12px; padding:16px; border:none; 
              border-radius:8px; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.1);}
    .checkout input, .checkout textarea, .checkout select{width:100%; padding:10px; 
                                                          border:1px solid #e0e0e0; 
                                                          border-radius:6px; font-size:13px; 
                                                          transition:border-color 0.2s ease; background:#fff;
                                                          font-family:inherit;}
    .checkout input:focus, .checkout textarea:focus, .checkout select:focus{
      border-color:var(--primary); outline:none; box-shadow:0 0 0 2px rgba(89,83,119,0.1);}
    .checkout textarea{min-height:60px; resize:vertical; font-family:inherit;}
    .hint{font-size:11px; color:var(--muted); margin-top:4px;}
    .radio-row{display:flex; flex-direction:column; gap:8px;}
    .radio-row label{display:flex; align-items:center; gap:8px; cursor:pointer; 
                     font-weight:500; font-size:13px; padding:6px; border-radius:6px;
                     transition:background-color 0.2s ease;}
    .radio-row label:hover{background:#f5f5f5;}
    .radio-row input[type="radio"]{margin:0; width:16px; height:16px; accent-color:var(--primary);}
    .ok{color:var(--ok); font-weight:500;} 
    .err{color:var(--danger); font-weight:500;}
    .empty{padding:40px; text-align:center; color:var(--muted); font-size:15px;}

    /* –ú–æ–±–∏–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; 
                    align-items:center; justify-content:center; z-index:9999; backdrop-filter:blur(8px);}
    .modal{width:90vw; max-width:400px; background:#fff; border-radius:var(--radius); 
           box-shadow:var(--shadow-lg); padding:24px; border:none;}
    .modal h3{margin:0 0 20px; font-size:20px; color:var(--text); font-weight:600;}
    .modal .row{margin-bottom:16px;}
    .modal input{width:100%; padding:12px; border:1px solid var(--line); border-radius:var(--radius); 
                 font-size:14px; transition:border-color 0.2s ease;}
    .modal input:focus{border-color:var(--primary); outline:none; box-shadow:0 0 0 3px rgba(89,83,119,0.1);}
    .modal .actions{display:flex; gap:12px; justify-content:flex-end; margin-top:20px; flex-wrap:wrap;}
    .pill{border-radius:var(--radius); padding:10px 16px; border:1px solid var(--line); 
          background:#fff; cursor:pointer; font-weight:500; font-size:14px; transition:all 0.2s ease;}
    .pill:hover{transform:translateY(-1px);}
    .pill.primary{background:var(--primary); color:#fff; border-color:var(--primary);}
    .pill.primary:hover{background:#4a4563;}
    .pill.ghost{background:#f7fafc; color:var(--primary); border-color:var(--primary);}
    .pill.gray{background:var(--secondary); color:#fff; border-color:var(--secondary);}

    .toast{position:fixed; right:16px; bottom:16px; background:var(--primary); color:#fff; 
           padding:12px 16px; border-radius:var(--radius); opacity:0.95; display:none; 
           z-index:10000; font-weight:500; box-shadow:var(--shadow-lg); 
           max-width:300px; animation:slideIn 0.3s ease;}
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 0.95; }
    }

    /* –ú–æ–±–∏–ª—å–Ω—ã–π —Ñ—É—Ç–µ—Ä */
    footer{background:var(--text); color:#fff; padding:32px 0; margin-top:60px;}
    .footer-content{max-width:100%; margin:0; padding:0 16px; text-align:center;}
    .footer-logo{display:flex; align-items:center; justify-content:center; gap:12px; 
                 margin-bottom:20px; font-size:18px; font-weight:600;}
    .footer-logo img{height:28px; width:auto;}
    .footer-info{display:grid; grid-template-columns:1fr; gap:20px; margin:20px 0;}
    .footer-section h4{font-size:16px; margin-bottom:12px; color:#fff; font-weight:600;}
    .footer-section p, .footer-section a{color:#a0aec0; text-decoration:none; 
                                         line-height:1.6; margin-bottom:6px; font-size:14px;}
    .footer-section a:hover{color:#fff;}
    .footer-bottom{border-top:1px solid rgba(255,255,255,0.1); padding-top:16px; 
                   margin-top:20px; color:#a0aec0; font-size:13px;}
    
    @media (min-width: 768px) {
      .footer-info{grid-template-columns:repeat(3, 1fr); gap:24px;}
      .footer-content{padding:0 20px;}
      footer{padding:40px 0; margin-top:80px;}
    }

    /* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; 
                    align-items:center; justify-content:center; z-index:9999; backdrop-filter:blur(8px);}
    .modal{width:400px; max-width:95vw; background:#fff; border-radius:var(--radius); 
           box-shadow:var(--shadow-lg); padding:24px; border:none; animation:modalSlideIn 0.3s ease;}
    .modal h3{margin:0 0 20px; font-size:20px; color:var(--text); font-weight:600;}
    .modal .row{margin-bottom:16px;}
    .modal input{width:100%; padding:12px; border:1px solid var(--line); border-radius:var(--radius); 
                 font-size:14px; transition:border-color 0.2s ease;}
    .modal input:focus{border-color:var(--primary); outline:none; box-shadow:0 0 0 3px rgba(89,83,119,0.1);}
    .modal .actions{display:flex; gap:12px; justify-content:flex-end; margin-top:20px; flex-wrap:wrap;}
    .pill{border-radius:var(--radius); padding:10px 16px; border:1px solid var(--line); 
          background:#fff; cursor:pointer; font-weight:500; font-size:14px; transition:all 0.2s ease;}
    .pill:hover{transform:translateY(-1px);}
    .pill.primary{background:var(--primary); color:#fff; border-color:var(--primary);}
    .pill.primary:hover{background:#4a4563;}
    .pill.ghost{background:#f7fafc; color:var(--primary); border-color:var(--primary);}
    .pill.gray{background:var(--secondary); color:#fff; border-color:var(--secondary);}

    .toast{position:fixed; right:20px; bottom:20px; background:var(--primary); color:#fff; 
           padding:12px 16px; border-radius:var(--radius); opacity:0.95; display:none; 
           z-index:10000; font-weight:500; box-shadow:var(--shadow-lg); 
           max-width:300px; animation:slideIn 0.3s ease;}
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 0.95; }
    }
    
    @keyframes modalSlideIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Ñ—É—Ç–µ—Ä */
    footer{background:#f8f9fa; border-top:1px solid var(--line); margin-top:60px; padding:24px 0;}
    .footer-content{max-width:1200px; margin:0 auto; padding:0 16px; text-align:center;}
    .footer-logo{display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:16px;}
    .footer-logo img{height:24px; width:auto;}
    .footer-bottom{color:var(--muted); font-size:12px; margin-top:16px;}
  </style>
</head>
<body class="loading">
  <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-spinner"></div>
    <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </div>

  <header>
    <div class="wrap row">
      <div class="brand">
        <img src="https://angiopharm.com/catalog/view/theme/tt_artfurniture2/image/logo.svg" alt="Angiopharm" />
        
      </div>
      <div class="spacer"></div>

      <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –∏ —Å—Ç–∞—Ç—É—Å —Ä–æ–ª–∏ -->
      <button class="login-btn" id="btnCosmoLogin">–í—Ö–æ–¥ –¥–ª—è –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∞</button>
      <div class="badge" id="cosmoStatus">–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥</div>
      <button class="logout-btn" id="btnCosmoLogout">–í—ã–π—Ç–∏</button>

      <button class="cart-btn" id="openCart">üõí <span id="cartCount">0</span></button>
    </div>
  </header>

  <main class="wrap">
    <!-- –§–∏–ª—å—Ç—Ä—ã: –ø–æ–∏—Å–∫ + –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class="filterbar">
      <div class="search">
        <span class="icon"></span>
        <input id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é‚Ä¶" />
        <button id="searchClear" class="clear" title="–û—á–∏—Å—Ç–∏—Ç—å">√ó</button>
      </div>
      <div id="categoryChips" class="category-chips"></div>
    </div>

    <div id="grid" class="grid"></div>
  </main>

  <aside class="drawer" id="drawer">
    <header>
      <strong>–ö–æ—Ä–∑–∏–Ω–∞</strong>
      <div class="spacer"></div>
      <button class="secondary" id="closeCart">–ó–∞–∫—Ä—ã—Ç—å</button>
    </header>
    <div class="cart-list" id="cartList"></div>
    <div class="cart-footer">
      <div class="total"><span>–ò—Ç–æ–≥–æ</span><span id="total">0</span></div>
      <div class="checkout">
        <input id="name" placeholder="–ò–º—è" />
        <input id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" />
        <textarea id="note" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
        <div class="radio-row">
          <label><input type="radio" name="pm" value="cash_on_delivery" checked> –û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</label>
          <label><input type="radio" name="pm" value="prepaid"> –û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞ (–ø—Ä–∏–ª–æ–∂–∏—Ç—å —á–µ–∫)</label>
        </div>
        <div id="receiptWrap" style="display:none">
          <input type="file" id="receipt" accept="image/*,application/pdf" />
          <div class="hint">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å–∫—Ä–∏–Ω/—Ñ–æ—Ç–æ —á–µ–∫–∞</div>
        </div>
        <button class="primary" id="submitOrder">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        <div id="msg" class="hint"></div>
      </div>
    </div>
  </aside>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –≤—Ö–æ–¥–∞ –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∞ -->
  <div class="modal-backdrop" id="cosmoModal">
    <div class="modal">
      <h3>–í—Ö–æ–¥ –¥–ª—è –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∞</h3>
      <div class="row">
        <input id="cosmoLogin" placeholder="–õ–æ–≥–∏–Ω" />
      </div>
      <div class="row">
        <input id="cosmoPass" placeholder="–ü–∞—Ä–æ–ª—å" type="password" />
      </div>
      <div class="actions">
        <button class="pill gray" id="cosmoRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        <button class="pill" id="cosmoCancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="pill primary" id="cosmoDoLogin">–í–æ–π—Ç–∏</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <!-- –§—É—Ç–µ—Ä —Å–∞–π—Ç–∞ -->
  <footer>
    <div class="footer-content">
      <div class="footer-logo">
        <img src="https://angiopharm.com/catalog/view/theme/tt_artfurniture2/image/logo.svg" alt="Angiopharm" />
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 Angiopharm. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      </div>
    </div>
  </footer>

  <script>
    // === –í–°–¢–ê–í–¨ —Å–≤–æ–π /exec:
    const API_BASE = 'https://script.google.com/macros/s/AKfycbxuWdDv2ZGPSy2S_KC3FQtiWBexcVQND0zlMFh2C9IniafdsiNoMcR6uyPE1In8fLm_/exec';

    const LS_CART = 'market_cart_v1';
    const LS_TOKEN = 'market_token';
    const LS_ROLE  = 'market_role';
    const LS_NAME  = 'market_name';

    const grid = document.getElementById('grid');
    const drawer = document.getElementById('drawer');
    const cartList = document.getElementById('cartList');
    const openCartBtn = document.getElementById('openCart');
    const closeCartBtn = document.getElementById('closeCart');
    const totalEl = document.getElementById('total');
    const cartCountEl = document.getElementById('cartCount');
    const nameEl = document.getElementById('name');
    const phoneEl = document.getElementById('phone');
    const noteEl = document.getElementById('note');
    const receiptWrap = document.getElementById('receiptWrap');
    const receiptEl = document.getElementById('receipt');
    const msgEl = document.getElementById('msg');

    // –§–∏–ª—å—Ç—Ä—ã
    const categoryChips = document.getElementById('categoryChips');
    const searchInput = document.getElementById('searchInput');
    const searchClear = document.getElementById('searchClear');

    const btnCosmoLogin = document.getElementById('btnCosmoLogin');
    const btnCosmoLogout = document.getElementById('btnCosmoLogout');
    const cosmoStatus = document.getElementById('cosmoStatus');
    const cosmoModal = document.getElementById('cosmoModal');
    const cosmoLogin = document.getElementById('cosmoLogin');
    const cosmoPass  = document.getElementById('cosmoPass');
    const cosmoDoLogin = document.getElementById('cosmoDoLogin');
    const cosmoCancel  = document.getElementById('cosmoCancel');
    const cosmoRegister = document.getElementById('cosmoRegister');

    // –î–∞–Ω–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ –ø–∞–º—è—Ç–∏
    let allProducts = [];
    let activeCategory = '–í—Å–µ';
    let searchQuery = '';

    function toast(msg){
      const t = document.getElementById('toast');
      if(t) {
      t.textContent = msg; t.style.display = 'block';
      setTimeout(()=> t.style.display='none', 2500);
      }
    }

    function fmtMoney(n, cur='TJS'){
      try{ return new Intl.NumberFormat('ru-RU',{style:'currency',currency:cur}).format(n); }
      catch(_){ return (Number(n).toFixed(2) + ' —Ä.'); }
    }

    // ========== –ü–†–û–°–¢–ê–Ø –ò –ù–ê–î–ï–ñ–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ö–û–†–ó–ò–ù–´ ==========
    
    let cart = [];
    
    function loadCart() {
      try {
        const saved = localStorage.getItem(LS_CART);
        cart = saved ? JSON.parse(saved) : [];
      } catch (e) {
        cart = [];
      }
      updateCartDisplay();
    }
    
    function saveCart() {
      try {
        localStorage.setItem(LS_CART, JSON.stringify(cart));
        updateCartDisplay();
      } catch (e) {
        console.error('Error saving cart:', e);
      }
    }
    
    function addToCart(product, quantity = 1) {
      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º product.id –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
      const stringId = String(product.id);
      const existingItem = cart.find(item => String(item.id) === stringId);
      
      if (existingItem) {
        existingItem.qty += quantity;
      } else {
        cart.push({
          id: product.id, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ID (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ —á–∏—Å–ª–æ–º)
          name: product.name,
          price: product.price,
          currency: product.currency || 'TJS',
          photo: product.photo || '',
          qty: quantity
        });
      }
      
      saveCart();
      drawer.classList.add('open');
      document.body.classList.add('cart-open');
    }

    function updateQuantity(itemId, newQty) {
      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º itemId –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
      const stringId = String(itemId);
      const item = cart.find(item => String(item.id) === stringId);
      if (item) {
        item.qty = Math.max(1, parseInt(newQty) || 1);
        saveCart();
      }
    }
    
    function removeItem(itemId) {
      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º itemId –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
      const stringId = String(itemId);
      cart = cart.filter(item => String(item.id) !== stringId);
      saveCart();
    }
    
    function clearCart() {
      cart = [];
      saveCart();
    }
    
    function getTotal() {
      return cart.reduce((total, item) => total + (item.price * item.qty), 0);
    }
    
    function getTotalItems() {
      return cart.reduce((total, item) => total + item.qty, 0);
    }
    
    function updateCartDisplay() {
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤ —à–∞–ø–∫–µ
      cartCountEl.textContent = getTotalItems();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã
      if (cart.length === 0) {
        cartList.innerHTML = '<div class="empty">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
        totalEl.textContent = '0 TJS';
        return;
      }
      
      cartList.innerHTML = cart.map(item => `
        <div class="cart-item" data-id="${item.id}">
          <img src="${item.photo}" alt="${item.name}" />
          <div class="details">
            <div class="name">${item.name}</div>
            <div class="price">${fmtMoney(item.price, item.currency)}</div>
            <div class="qty-controls">
              <button class="qty-btn minus" onclick="updateQuantity('${item.id}', ${item.qty - 1})">-</button>
              <input type="number" value="${item.qty}" min="1" class="qty-input" 
                     onchange="updateQuantity('${item.id}', this.value)" />
              <button class="qty-btn plus" onclick="updateQuantity('${item.id}', ${item.qty + 1})">+</button>
              <button class="remove-btn" onclick="removeItem('${item.id}')">√ó</button>
          </div>
          </div>
        </div>
      `).join('');
      
      totalEl.textContent = fmtMoney(getTotal(), 'TJS');
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    window.addToCart = addToCart;
    window.updateQuantity = updateQuantity;
    window.removeItem = removeItem;
    window.clearCart = clearCart;
    window.getCart = () => cart;
    window.setCart = (newCart) => {
      cart = newCart;
      saveCart();
    };
    
    // ========== –ö–û–ù–ï–¶ –°–ò–°–¢–ï–ú–´ –ö–û–†–ó–ò–ù–´ ==========

    function phoneValid(p){ return /^[+]?[-()\d\s]{7,}$/.test(String(p||'').trim()); }

    async function fileToBase64(file){
      if (!file) return '';
      const buf = await file.arrayBuffer();
      let b64 = btoa(String.fromCharCode(...new Uint8Array(buf)));
      return `data:${file.type||'application/octet-stream'};base64,` + b64;
    }

    async function submitOrder(){
      const name = nameEl.value.trim();
      const phone = phoneEl.value.trim();
      const note = noteEl.value.trim();
      const pm = (document.querySelector('input[name="pm"]:checked')?.value)||'cash_on_delivery';
      if (!name) return msg('–£–∫–∞–∂–∏—Ç–µ –∏–º—è', true);
      if (!phoneValid(phone)) return msg('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω', true);
      if (cart.length===0) return msg('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞', true);

      msg('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑‚Ä¶');
      try{
        let receipt_b64 = '';
        if (pm === 'prepaid' && receiptEl.files?.[0]) receipt_b64 = await fileToBase64(receiptEl.files[0]);

        const token = localStorage.getItem(LS_TOKEN) || '';
        const payload = {
          token, name, phone, note,
          payment_method: pm,
          cart: cart.map(x=>({id:x.id, qty:x.qty})),
          receipt_base64: receipt_b64
        };

        const res = await fetch(API_BASE + '?page=createorder', {
          method:'POST',
          headers:{ 'Content-Type':'text/plain;charset=utf-8' },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (data.ok){
          msg(`–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! ‚Ññ ${data.order_id}. –°—É–º–º–∞: ${new Intl.NumberFormat('ru-RU').format(data.total)}.`);
          clearCart(); // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
          receiptEl.value = '';
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞
          drawer.classList.remove('open');
          document.body.classList.remove('cart-open');
        } else {
          msg('–û—à–∏–±–∫–∞: ' + (data.error||'–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'), true);
        }
      }catch(err){
        msg('–°–µ—Ç—å/—Å–µ—Ä–≤–µ—Ä: ' + err.message, true);
      }
    }

    function msg(t, err){ msgEl.textContent = t; msgEl.className = 'hint ' + (err?'err':'ok'); }

    // ---------- INIT ----------
    // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.body.classList.remove('loading');
        const loadingScreen = document.getElementById('loadingScreen');
        loadingScreen.classList.add('hidden');
        setTimeout(() => {
          loadingScreen.style.display = 'none';
        }, 500);
      }, 1000); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    });

    openCartBtn.onclick = ()=> {
      drawer.classList.add('open');
      document.body.classList.add('cart-open');
    };
    closeCartBtn.onclick = ()=> {
      drawer.classList.remove('open');
      document.body.classList.remove('cart-open');
    };
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ—ë –æ–±–ª–∞—Å—Ç–∏
    drawer.addEventListener('click', (e) => {
      if (e.target === drawer) {
        drawer.classList.remove('open');
        document.body.classList.remove('cart-open');
      }
    });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ–ª—è–º –≤–≤–æ–¥–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
    function scrollToInput(inputElement) {
      if (window.innerWidth <= 768) {
        setTimeout(() => {
          const drawer = document.getElementById('drawer');
          const cartFooter = drawer.querySelector('.cart-footer');
          if (cartFooter) {
            cartFooter.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'end',
              inline: 'nearest'
            });
          }
        }, 300); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
      }
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ–∫—É—Å–∞ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
    nameEl.addEventListener('focus', () => scrollToInput(nameEl));
    phoneEl.addEventListener('focus', () => scrollToInput(phoneEl));
    noteEl.addEventListener('focus', () => scrollToInput(noteEl));
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ viewport (–¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã)
    let initialViewportHeight = window.innerHeight;
    window.addEventListener('resize', () => {
      const currentHeight = window.innerHeight;
      if (currentHeight < initialViewportHeight * 0.75 && drawer.classList.contains('open')) {
        // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ—Ç–∫—Ä—ã—Ç–∞, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –∫–æ—Ä–∑–∏–Ω—ã
        const drawer = document.getElementById('drawer');
        drawer.style.height = currentHeight + 'px';
      } else if (currentHeight >= initialViewportHeight * 0.75) {
        // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∑–∞–∫—Ä—ã—Ç–∞, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
        const drawer = document.getElementById('drawer');
        drawer.style.height = '';
      }
    });
    document.getElementById('submitOrder').onclick = submitOrder;

    document.querySelectorAll('input[name="pm"]').forEach(r=>{
      r.addEventListener('change', ()=>{
        receiptWrap.style.display = (document.querySelector('input[name="pm"]:checked')?.value === 'prepaid') ? '' : 'none';
      });
    });

    // ---------- –†–û–õ–ò / –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ----------
    function setCosmoUI(role, name){
      if (role === 'cosmetologist'){
        cosmoStatus.textContent = '–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥' + (name? ' ‚Äî ' + name : '');
        cosmoStatus.style.display = 'inline-flex';
        btnCosmoLogout.style.display = 'inline-block';
        btnCosmoLogin.style.display = 'none';
      } else {
        cosmoStatus.style.display = 'none';
        btnCosmoLogout.style.display = 'none';
        btnCosmoLogin.style.display = 'inline-block';
      }
    }

    btnCosmoLogin.addEventListener('click', ()=> { cosmoModal.style.display='flex'; setTimeout(()=>cosmoLogin.focus(), 50); });
    cosmoCancel.addEventListener('click', ()=> { cosmoModal.style.display='none'; });

    cosmoRegister.addEventListener('click', ()=> {
      toast('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.');
    });

    btnCosmoLogout.addEventListener('click', ()=>{
      localStorage.removeItem(LS_TOKEN);
      localStorage.removeItem(LS_ROLE);
      localStorage.removeItem(LS_NAME);
      clearCart(); // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
      setCosmoUI('guest','');
      toast('–í—ã –≤—ã—à–ª–∏');
      loadProducts();
    });

    cosmoDoLogin.addEventListener('click', doLogin);
    cosmoPass.addEventListener('keydown', (e)=>{ if (e.key==='Enter') doLogin(); });

    async function doLogin(){
      const login = (cosmoLogin.value||'').trim();
      const password = (cosmoPass.value||'').trim();
      if (!login || !password){ toast('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å'); return; }
      try{
        const res = await fetch(API_BASE+'?page=login', {
          method:'POST',
          headers:{'Content-Type':'text/plain;charset=utf-8'},
          body: JSON.stringify({ login, password })
        });
        const data = await res.json();
        if (!data.ok){ toast(data.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞'); return; }
        localStorage.setItem(LS_TOKEN, data.token);
        localStorage.setItem(LS_ROLE,  data.role||'user');
        localStorage.setItem(LS_NAME,  data.name||'');
        setCosmoUI(data.role, data.name);
        cosmoModal.style.display='none';
        toast('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
        loadProducts();
      }catch(e){
        toast('–°–µ—Ç—å: '+e.message);
      }
    }

    // ---------- –§–ò–õ–¨–¢–†–´ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + –ø–æ–∏—Å–∫) ----------
    function buildCategories(products){
      const counts = {};
      for (const p of products){
        const cat = (p.category || '').trim() || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
        counts[cat] = (counts[cat]||0) + 1;
      }
      const cats = Object.keys(counts).sort((a,b)=> a.localeCompare(b, 'ru'));
      return {counts, cats};
    }

    function renderCategoryChips(){
      const {counts, cats} = buildCategories(allProducts);
      const allCount = allProducts.length;
      const items = ['–í—Å–µ', ...cats];
      categoryChips.innerHTML = items.map(cat=>{
        const cnt = (cat==='–í—Å–µ') ? allCount : (counts[cat]||0);
        const active = (activeCategory===cat) ? 'active' : '';
        return `<div class="chip ${active}" data-cat="${cat}">${cat}<span class="count">${cnt}</span></div>`;
      }).join('');
      // –ù–∞–≤–µ—Å–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
      categoryChips.querySelectorAll('.chip').forEach(ch=>{
        ch.addEventListener('click', ()=>{
          activeCategory = ch.getAttribute('data-cat');
          // –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∞–∫—Ç–∏–≤
          categoryChips.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
          ch.classList.add('active');
          applyFiltersAndRender();
        });
      });
    }

    function applyFiltersAndRender(){
      const q = searchQuery.trim().toLowerCase();
      const list = allProducts.filter(p=>{
        const byCat = (activeCategory==='–í—Å–µ') ? true :
          ((p.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏') === activeCategory);
        const bySearch = !q ? true :
          (String(p.name||'').toLowerCase().includes(q) || String(p.desc||'').toLowerCase().includes(q));
        return byCat && bySearch;
      });
      renderGrid(list);
    }

    function renderGrid(list){
      if (!list || list.length===0){
        grid.innerHTML = '<div class="empty">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
        return;
      }
      grid.innerHTML = list.map(p=>{
        const priceTag = (p.price_type === 'cosmo') ? '<span class="tag">–¥–ª—è –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∞</span>' : '';
        return `
        <div class="card" data-product-id="${p.id}">
          <img src="${p.photo||''}" alt="${p.name}" />
          <div class="body">
            <div class="title">${p.name}</div>
            <div class="price">${fmtMoney(p.price, p.currency||'TJS')} ${priceTag}</div>
            <div class="actions">
              <button class="primary" onclick="addToCart(allProducts.find(product => product.id === '${p.id}'), 1)">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
            </div>
          </div>
        </div>`;
      }).join('');
    }

    // ---------- –ö–ê–¢–ê–õ–û–ì ----------
    async function loadProducts(){
      grid.innerHTML = '<div class="empty">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>';
      try{
        const token = localStorage.getItem(LS_TOKEN) || '';
        const url = API_BASE + '?page=products' + (token?('&token='+encodeURIComponent(token)):'');
        const res = await fetch(url);
        const data = await res.json();
        if (!data.ok) throw new Error(data.error||'–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –±–µ–∑ ok');

        const arr = data.data||[];
        // –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–¥ —Ä–µ–Ω–¥–µ—Ä (—Ü–µ–Ω–∞ —É–∂–µ effective)
        allProducts = arr.map(p=>{
          const effective = (typeof p.effective_price === 'number' && !isNaN(p.effective_price)) ? p.effective_price : (p.price||0);
          return {
            id: p.id,
            name: p.name,
            desc: p.desc||'',
            currency: p.currency || 'TJS',
            photo: p.photo||'',
            category: (p.category||'').trim() || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
            price: effective,
            price_type: p.price_type || 'retail'
          };
        });

        // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º/—Å–±—Ä–æ—Å–∏–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –µ—Å–ª–∏ –µ—ë —É–∂–µ –Ω–µ—Ç
        const {cats} = buildCategories(allProducts);
        if (activeCategory!=='–í—Å–µ' && !cats.includes(activeCategory)) activeCategory = '–í—Å–µ';

        renderCategoryChips();
        applyFiltersAndRender();
      }catch(err){
        grid.innerHTML = '<div class="empty">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥: ' + err.message + '</div>';
      }
    }

    // –ü–æ–∏—Å–∫ —Å –¥–µ–±–∞—É–Ω—Å–æ–º
    let searchT = null;
    searchInput.addEventListener('input', ()=>{
      if (searchT) clearTimeout(searchT);
      searchT = setTimeout(()=>{
        searchQuery = searchInput.value || '';
        applyFiltersAndRender();
      }, 200);
    });
    searchClear.addEventListener('click', ()=>{
      searchInput.value = '';
      searchQuery = '';
      applyFiltersAndRender();
      searchInput.focus();
    });

    // ---------- INIT ----------
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–æ–ª–∏ –≤ —à–∞–ø–∫–µ
    (function initRole(){
      const role = localStorage.getItem(LS_ROLE) || 'guest';
      const name = localStorage.getItem(LS_NAME) || '';
      setCosmoUI(role, name);
    })();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã
    loadCart();

    loadProducts();





  </script>
</body>
</html>
